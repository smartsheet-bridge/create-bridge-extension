"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[718],{5318:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return m}});var a=t(7378);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var c=a.createContext({}),l=function(e){var n=a.useContext(c),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},u=function(e){var n=l(e.components);return a.createElement(c.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},d=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,c=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=l(t),m=r,h=d["".concat(c,".").concat(m)]||d[m]||p[m]||o;return t?a.createElement(h,i(i({ref:n},u),{},{components:t})):a.createElement(h,i({ref:n},u))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=d;var s={};for(var c in n)hasOwnProperty.call(n,c)&&(s[c]=n[c]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=t[l];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}d.displayName="MDXCreateElement"},517:function(e,n,t){var a=t(7378);n.Z=function(e){var n=e.children,t=e.hidden,r=e.className;return a.createElement("div",{role:"tabpanel",hidden:t,className:r},n)}},6359:function(e,n,t){t.d(n,{Z:function(){return u}});var a=t(7378),r=t(4309),o=t(8944),i="tabItem_c0e5",s="tabItemActive_28AG";var c=37,l=39;var u=function(e){var n=e.lazy,t=e.block,u=e.defaultValue,p=e.values,d=e.groupId,m=e.className,h=(0,r.Z)(),f=h.tabGroupChoices,v=h.setTabGroupChoices,g=(0,a.useState)(u),k=g[0],y=g[1],b=a.Children.toArray(e.children),N=[];if(null!=d){var w=f[d];null!=w&&w!==k&&p.some((function(e){return e.value===w}))&&y(w)}var x=function(e){var n=e.currentTarget,t=N.indexOf(n),a=p[t].value;y(a),null!=d&&(v(d,a),setTimeout((function(){var e,t,a,r,o,i,c,l;(e=n.getBoundingClientRect(),t=e.top,a=e.left,r=e.bottom,o=e.right,i=window,c=i.innerHeight,l=i.innerWidth,t>=0&&o<=l&&r<=c&&a>=0)||(n.scrollIntoView({block:"center",behavior:"smooth"}),n.classList.add(s),setTimeout((function(){return n.classList.remove(s)}),2e3))}),150))},j=function(e){var n,t;switch(e.keyCode){case l:var a=N.indexOf(e.target)+1;t=N[a]||N[0];break;case c:var r=N.indexOf(e.target)-1;t=N[r]||N[N.length-1]}null==(n=t)||n.focus()};return a.createElement("div",{className:"tabs-container"},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":t},m)},p.map((function(e){var n=e.value,t=e.label;return a.createElement("li",{role:"tab",tabIndex:k===n?0:-1,"aria-selected":k===n,className:(0,o.Z)("tabs__item",i,{"tabs__item--active":k===n}),key:n,ref:function(e){return N.push(e)},onKeyDown:j,onFocus:x,onClick:x},t)}))),n?(0,a.cloneElement)(b.filter((function(e){return e.props.value===k}))[0],{className:"margin-vert--md"}):a.createElement("div",{className:"margin-vert--md"},b.map((function(e,n){return(0,a.cloneElement)(e,{key:n,hidden:e.props.value!==k})}))))}},4956:function(e,n,t){var a=(0,t(7378).createContext)(void 0);n.Z=a},4309:function(e,n,t){var a=t(7378),r=t(4956);n.Z=function(){var e=(0,a.useContext)(r.Z);if(null==e)throw new Error("`useUserPreferencesContext` is used outside of `Layout` Component.");return e}},2920:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},metadata:function(){return s},toc:function(){return c},default:function(){return u}});var a=t(5773),r=t(808),o=(t(7378),t(5318)),i=(t(6359),t(517),{id:"function",title:"Functions"}),s={unversionedId:"concepts/function",id:"concepts/function",isDocsHomePage:!1,title:"Functions",description:'A "function" is a single unit of code that can be triggered by an external system. A function will execute with some inputs, and return an output.',source:"@site/docs/concepts/function.mdx",sourceDirName:"concepts",slug:"/concepts/function",permalink:"/create-bridge-extension/concepts/function",version:"current",frontMatter:{id:"function",title:"Functions"},sidebar:"docs",previous:{title:"Specification File",permalink:"/create-bridge-extension/concepts/spec"},next:{title:"Add Module",permalink:"/create-bridge-extension/recipes/add_module"}},c=[{value:"Function Parameters",id:"function-parameters",children:[{value:"<code>inputs</code>",id:"inputs",children:[]},{value:"<code>context</code>",id:"context",children:[]}]},{value:"Function Response",id:"function-response",children:[{value:"Primitives",id:"primitives",children:[]},{value:"Promises",id:"promises",children:[]},{value:"Thunks",id:"thunks",children:[]},{value:"Errors",id:"errors",children:[]},{value:"Response Objects",id:"response-objects",children:[]}]}],l={toc:c};function u(e){var n=e.components,t=(0,r.Z)(e,["components"]);return(0,o.kt)("wrapper",(0,a.Z)({},l,t,{components:n,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'A "function" is a single unit of code that can be triggered by an external system. A function will execute with some inputs, and return an output.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const myFunction = inputs => ({ result: `Hello, ${inputs.username}` });\n")),(0,o.kt)("h2",{id:"function-parameters"},"Function Parameters"),(0,o.kt)("p",null,"An extension function always takes two parameters: ",(0,o.kt)("inlineCode",{parentName:"p"},"inputs"),", and ",(0,o.kt)("inlineCode",{parentName:"p"},"context"),"."),(0,o.kt)("h3",{id:"inputs"},(0,o.kt)("inlineCode",{parentName:"h3"},"inputs")),(0,o.kt)("p",null,"An extension defined, user-populated map of input parameters that are provided to the function at execution time."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"type inputs = Record<string, any>;\n")),(0,o.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"User data")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Each input parameter consists of user populated data and therefore should be treated with extreme care and ",(0,o.kt)("strong",{parentName:"p"},"always assumed that the input is unsafe"),"."),(0,o.kt)("p",{parentName:"div"},(0,o.kt)("strong",{parentName:"p"},"Remember that user data may contain sensitive information")," so please follow ",(0,o.kt)("a",{parentName:"p",href:"../advanced/best_practices#logging"},"logging best practices"),"."))),(0,o.kt)("p",null,"The properties available are defined in the ",(0,o.kt)("a",{parentName:"p",href:"/concepts/spec"},"Spec File"),". E.g. given the following ",(0,o.kt)("a",{parentName:"p",href:"/concepts/spec"},"Spec File")," with a module called ",(0,o.kt)("inlineCode",{parentName:"p"},"myModule")," and a parameter defined as ",(0,o.kt)("inlineCode",{parentName:"p"},"myInput")," of type ",(0,o.kt)("inlineCode",{parentName:"p"},"STRING"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json",metastring:"{4,8}","{4,8}":!0},'{\n  "module": [\n    {\n      "id": "myModule",\n      "hasReturn": true,\n      "param": [\n        {\n          "param": "myInput",\n          "type": "STRING"\n        }\n      ]\n    }\n  ]\n}\n')),(0,o.kt)("p",null,"The resulting ",(0,o.kt)("inlineCode",{parentName:"p"},"inputs")," type would have the following type signature:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"{\n  myInput: string;\n}\n")),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"If using TypeScript to build an extension it's extremely good practice to type-define these inputs in the module signature."),(0,o.kt)("pre",{parentName:"div"},(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"type MyInputs = {\n  myInput: string\n}\n\nexport const myModule: ModuleFunction<MyInputs> = inputs => { ... };\n")))),(0,o.kt)("h3",{id:"context"},(0,o.kt)("inlineCode",{parentName:"h3"},"context")),(0,o.kt)("p",null,"An object that consists of metadata properties in the context of the triggering user, account, and extension. This context will differ slightly from function to function but generally speaking it will always include registration settings, authentication details, and an object describing the caller of the function (account/user)."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"type context = Record<string, any>;\n")),(0,o.kt)("h2",{id:"function-response"},"Function Response"),(0,o.kt)("p",null,"Returning a response from a Function is very similar from returning a response from any other JavaScript function including returning ",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise"},"promises")," and ",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Thunk"},"thunks"),". The only difference is that the resulting value must evaluate to an object."),(0,o.kt)("h3",{id:"primitives"},"Primitives"),(0,o.kt)("p",null,"Strings, numbers, and booleans cannot be returned directly so must be included in an object."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const aStringResponse = () => ({ result: 'a string response' });\n\nexport const aNumberResponse = () => ({ result: 42 });\n\nexport const aBooleanResponse = () => ({ result: true });\n")),(0,o.kt)("p",null,"Arrays can also be returned, but like above, cannot be returned directly so must be included in an object.\nObjects and arrays are also returned as normal."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const anArrayResponse = () => ({ result: ['one', 'two', 'three'] });\n")),(0,o.kt)("p",null,"Objects ",(0,o.kt)("strong",{parentName:"p"},"can")," be returned directly."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export function anObjectResponse() {\n  const myObject = { nested: { number: 42 } };\n  return myObject;\n}\n")),(0,o.kt)("h3",{id:"promises"},"Promises"),(0,o.kt)("p",null,"Promises will be executed and either fully resolved or rejected before eventually returning the response allowing you do write asynchronous extension functions as if they were synchronous."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember, only objects can be returned so a promise must eventually resolve to an object."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const anResolvedResponse = () => Promise.resolve({ result: 42 });\n")),(0,o.kt)("p",null,"Promises can also be chained."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const anChainedResponse = () =>\n  axios\n    .get('https://example.com/user?ID=12345')\n    .then(function (response) {\n      // handle success\n      return response;\n    })\n    .catch(function (error) {\n      // handle error\n      return error;\n    });\n")),(0,o.kt)("p",null,"You can also write promises using the ",(0,o.kt)("inlineCode",{parentName:"p"},"async"),"/",(0,o.kt)("inlineCode",{parentName:"p"},"await")," syntax."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"export const async anAsyncResponse = () => {\n  const response = await axios\n    .get('https://example.com/user?ID=12345')\n  return response;\n}\n")),(0,o.kt)("h3",{id:"thunks"},"Thunks"),(0,o.kt)("p",null,'If dealing with external libraries that make use of functions that require an async "callback" parameter, you can return a thunk. A thunk is a function that is returned by another. In this case the parameter of the thunk is a ',(0,o.kt)("inlineCode",{parentName:"p"},"respond")," function that can be called when you are ready to return. Learn more about ",(0,o.kt)("a",{parentName:"p",href:"/advanced/thunks"},"Using Thunks")," in our advanced guide."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"tip")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"Remember, only objects can be returned so a thunk must eventually resolve to an object."))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"{4,6}","{4,6}":!0},"// Extension Function.\nexport const async thunkResponse = () => {\n  // Thunk with respond parameter.\n  return (respond) => {\n    // Calling respond causes the extension to respond.\n    respond({ result: 42 })\n  }\n}\n")),(0,o.kt)("h3",{id:"errors"},"Errors"),(0,o.kt)("p",null,"There's nothing special about Errors when writing an extension function. Any error explicitly thrown or implicitly caught will be returned to the sender as an ",(0,o.kt)("inlineCode",{parentName:"p"},"ExtensionError"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"throw new Error('This will return an error');\n")),(0,o.kt)("h3",{id:"response-objects"},"Response Objects"),(0,o.kt)("p",null,"Each type of function (module, external, etc) has it's own response object for advanced development. This will be covered in the documentation later."))}u.isMDXComponent=!0},8944:function(e,n,t){function a(e){var n,t,r="";if("string"==typeof e||"number"==typeof e)r+=e;else if("object"==typeof e)if(Array.isArray(e))for(n=0;n<e.length;n++)e[n]&&(t=a(e[n]))&&(r&&(r+=" "),r+=t);else for(n in e)e[n]&&(r&&(r+=" "),r+=n);return r}function r(){for(var e,n,t=0,r="";t<arguments.length;)(e=arguments[t++])&&(n=a(e))&&(r&&(r+=" "),r+=n);return r}t.d(n,{Z:function(){return r}})}}]);