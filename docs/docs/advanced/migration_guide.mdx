---
id: migration_guide
title: Migration Guide
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Migration Guide

This is a reference for upgrading your existing Bridge by Smartsheet extension to the latest development tools and runtime handler.

## From `converse-cli` to `extension-scripts@0.x`

To use the new tooling with a legacy extension is quite simple and requires only three steps.

### Migration Steps

1.  #### Modify the source code to work with the new tooling

    Autogenerate your extension using the `converse-cli` one last time; make sure you are authenticated with the `converse-cli` tool, then run `converse-cli plugin init` in the root directory of your extension. This will initialize your extension by autogenerating the files needed and installing any dependencies.

    Open the newly autogenerated file called `plugin.js` and locate the only exported function. It will start with `exports.` and be a combination of your authenticated account name and the extension name. Something like the following example:

    ```js
    exports.myaccount_myextension = function (request, response) {
    ```

    Rename this function to `main`

    ```js
    exports.main = function (request, response) {
    ```

    To ensure your tests continue to work you may also need to modify any tests that rely on this function. In particular, the autogenerated `test/lib/express.js` file imports the root function and will need to be updated:

    ```git
    - const myfunction  = require('../../').myaccount_myfunction;
    + const myfunction  = require('../../').main;
    ```

    :::note Using version control?

    The new extension tooling no longer autogenerates extension code during initialization or deployment so now that you've generated the code for the last time you must remove it from your `.gitignore` file or similar so that they can be stored in your version control software.

    :::

1.  #### Replace `converse-cli` with `extension-scripts`

    Once you have autogenerated your code via the `converse-cli` for the final time, you can wave goodbye to the `converse-cli` ðŸ‘‹

    ```bash
    npm uninstall converse-cli
    ```

    :::note globally installed?
    If you were an early adopter of the `converse-cli` you may have installed it globally - this is now considered bad practice and the new tooling will not be installed in a similar way. If this applies to you, you may leave the globally installed instance of `converse-cli` in place, until such time that you do not need to work with non-migrated extensions. However, we are actively encouraging you to remove the `converse-cli` globally as well by running:

    ```bash
    npm uninstall -g converse-cli
    ```

    :::

    Install the `extension-scripts` package as a development dependency of your extension.

    ```
    npm install -D @smartsheet-bridge/extension-scripts
    ```

    Now you can run all the `extension-scripts` commands from the terminal using `node_modules/.bin/extension-scripts <cmd>` or run them directly from [npm scripts](https://docs.npmjs.com/cli/v8/using-npm/scripts) like `extension-scripts <cmd>`.

    :::tip best practice

    The team recommends you add the following scripts to your `package.json` file to help with development.

    ```json
    "account": "extension-scripts account",
    "deploy": "extension-scripts deploy",
    "revoke": "extension-scripts revoke",
    ```

    :::

    If you have been using `converse-cli` tool locally you may have already set up some scripts in your `package.json` file, in which case it may be useful to refer to the [table below](#command-line-comparison-table) regarding like-for-like commands in each tool. E.g.

    ```git
    - "deploy": "converse-cli deploy",
    + "deploy": "extension-scripts deploy",
    ```

    For more information on how to make the most of the new tooling, see [the extension-scripts API docs](/api/extension-scripts).

1.  #### Configure `extension-scripts` to work with legacy source code.

    The `converse-cli` tool was very opinionated and didn't allow for any user configuration. Alternatively, the new `extension-scripts` tool is extremely versatile and allows the developer to build extensions in the way that suits their own workflow. Having said that, 99% of the time we expect extension developers to stick to the best practices so to aid in that effort we have published config packages that can tell the tool how it should be configured.

    There are two:

    - [`extensionrc-standard`](https://www.npmjs.com/package/@smartsheet-bridge/extensionrc-standard)
    - [`extensionrc-legacy`](https://www.npmjs.com/package/@smartsheet-bridge/extensionrc-legacy)

    The first of these is the default and is recommended to be used by all extensions going forward as this closely matches our best practices. However, the second is designed to allow the new tooling to work immediately with a legacy extension built with the `converse-cli` without much refactoring.

    First install the `extensionrc-legacy` package as a development dependency.

    ```bash
    npm install -D @smartsheet-bridge/extensionrc-legacy
    ```

    Next override the default configuration by adding an extension property to your `package.json` file.

    ```git
      ...
    + "extension": {
    +   "extends": "@smartsheet-bridge/extensionrc-legacy"
    + }
    }
    ```

### Command line comparison table

The `extension-scripts` tool is designed to replace the `converse-cli` tool, so many of the commands are very similar with one exception: `extension-scripts` is not designed to autogenerate code like the `converse-cli` tool was and therefore where many of the commands below are similar, the `converse-cli plugin <cmd>` command does not have an equivalent in the new tooling.

| `converse-cli`              | `extension-scripts `                    |
| :-------------------------- | :-------------------------------------- |
| `converse-cli auth`         | `extension-scripts account add [alias]` |
| `converse-cli plugin <cmd>` | not supported                           |
| `converse-cli deploy`       | `extension-scripts deploy [alias]`      |
| `converse-cli revoke`       | `extension-scripts revoke [alias]`      |

Although the root commands are similar in function, the overall tooling has a few changes in philosophy:

- The `extension-scripts` tool is not designed to be installed globally, it should be installed as a development dependency for each extension at all times.
- The `extension-scripts` tool is designed to work perfectly out of the box with CI systems and therefore lacks many of the interactive elements you may have become accustomed to with the `converse-cli` tool.
- The `extension-scripts` tool does not require authentication until it's needed. Unlike the `converse-cli` tool that required authentication with exactly one account at all times the new tooling only requires authentication when you actually need to interact with the platform. This means that you can be authenticated with zero, one, or many accounts at the same time by using aliases. See [here for more information on aliases](/api/extension-scripts#account-aliases).

<!-- ## From `plugins-sdk` to `extension-handler@0.x` -->
